<!doctypehtml><html class=dark lang=en><meta charset=UTF-8><meta content=width=device-width,initial-scale=1.0 name=viewport><title>Robotic Arm Demo</title><script src=https://cdn.tailwindcss.com></script><script>tailwind.config={darkMode:`class`,theme:{extend:{colors:{'dark-bg':`#121212`,'dark-fg':`#f0f0f0`,'dark-control-bg':`#1e1e1e`,'dark-control-fg':`#ddd`,'dark-border':`#333`}}}}</script><style>body{color:#f0f0f0;background-color:#121212;flex-direction:column;justify-content:center;align-items:center;min-height:100vh;margin:0;font-family:sans-serif;display:flex}canvas{background-color:#f0f0f0;border:1px solid #333}</style></head><body class="bg-dark-bg text-dark-fg"><div style=margin-top:5vh></div><div id=canvasDiv></div><div class="bg-dark-control-bg p-4 border border-dark-border rounded-lg shadow-md mt-4 w-[95%] max-w-[95%]"id=controls-container><div class="flex justify-between items-center mb-4 cursor-pointer"onclick=toggleControls()><h2 class="text-xl font-semibold text-dark-control-fg">Expand controls</h2><svg class="w-6 h-6 text-dark-control-fg transform rotate-180 transition-transform duration-300"viewbox="0 0 24 24"fill=none id=collapse-icon stroke=currentColor><path d="M19 9l-7 7-7-7"stroke-linecap=round stroke-linejoin=round stroke-width=2 /></svg></div><div class="flex flex-wrap justify-center gap-x-8 gap-y-4 pb-4 border-b border-dark-border hidden"id=controls><div class="w-full border-b border-dark-border mb-4 pb-4"><h3 class="text-lg font-semibold text-dark-control-fg mb-2 text-center">PID Parameters</h3><div class=pid-control><label class="block text-sm font-medium text-dark-control-fg mb-1"for=kpSlider>Kp</label><div class="flex items-center space-x-2"><input class=w-32 id=kpSlider max=1 min=0 step=0.01 type=range value=0.1><input class="w-20 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=kpInput max=1 min=0 step=0.01 type=number value=0.1></div></div><div class=pid-control><label class="block text-sm font-medium text-dark-control-fg mb-1"for=kiSlider>Ki</label><div class="flex items-center space-x-2"><input class=w-32 id=kiSlider max=0.01 min=0 step=0.0001 type=range value=0.0><input class="w-20 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=kiInput max=0.01 min=0 step=0.0001 type=number value=0.0></div></div><div class=pid-control><label class="block text-sm font-medium text-dark-control-fg mb-1"for=kdSlider>Kd</label><div class="flex items-center space-x-2"><input class=w-32 id=kdSlider max=0.5 min=0 step=0.001 type=range value=0.22><input class="w-20 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=kdInput max=0.5 min=0 step=0.001 type=number value=0.22></div></div></div><div class=joint-limits><label class="block text-sm font-medium text-dark-control-fg mb-2 text-center">Joint 1 Limits (°)</label><div class="limit-pair flex items-center space-x-2 mb-1"><label class="block text-sm font-medium text-dark-control-fg"for=joint1MinSlider>Min</label><input class=w-24 id=joint1MinSlider max=180 min=-180 step=5 type=range value=-150><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint1MinInput max=180 min=-180 step=1 type=number value=-150></div><div class="limit-pair flex items-center space-x-2"><label class="block text-sm font-medium text-dark-control-fg"for=joint1MaxSlider>Max</label><input class=w-24 id=joint1MaxSlider max=180 min=-180 step=5 type=range value=-20><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint1MaxInput max=180 min=-180 step=1 type=number value=-20></div></div><div class=joint-limits><label class="block text-sm font-medium text-dark-control-fg mb-2 text-center">Joint 2 Limits (°)</label><div class="limit-pair flex items-center space-x-2 mb-1"><label class="block text-sm font-medium text-dark-control-fg"for=joint2MinSlider>Min</label><input class=w-24 id=joint2MinSlider max=180 min=-180 step=5 type=range value=0><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint2MinInput max=180 min=-180 step=1 type=number value=0></div><div class="limit-pair flex items-center space-x-2"><label class="block text-sm font-medium text-dark-control-fg"for=joint2MaxSlider>Max</label><input class=w-24 id=joint2MaxSlider max=180 min=-180 step=5 type=range value=155><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint2MaxInput max=180 min=-180 step=1 type=number value=155></div></div><div class=joint-limits><label class="block text-sm font-medium text-dark-control-fg mb-2 text-center">Joint 3 Limits (°)</label><div class="limit-pair flex items-center space-x-2 mb-1"><label class="block text-sm font-medium text-dark-control-fg"for=joint3MinSlider>Min</label><input class=w-24 id=joint3MinSlider max=180 min=-180 step=5 type=range value=0><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint3MinInput max=180 min=-180 step=1 type=number value=0></div><div class="limit-pair flex items-center space-x-2"><label class="block text-sm font-medium text-dark-control-fg"for=joint3MaxSlider>Max</label><input class=w-24 id=joint3MaxSlider max=180 min=-180 step=5 type=range value=155><input class="w-16 p-1 text-sm rounded text-dark-fg bg-dark-bg border border-dark-border"id=joint3MaxInput max=180 min=-180 step=1 type=number value=155></div></div></div><div class="flex justify-center space-x-4 mt-4"id=action-buttons><button class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded"id=resetButton>Reset Scene</button><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"id=createBallButton>Create Ball</button><button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"id=createBoxButton>Create Cube</button></div></div><script>var toggleControls=(()=>{let b=`rotate-180`,a=`hidden`;controlsVisible=!controlsVisible;if(controlsVisible){controlsDiv.classList.remove(a);collapseIcon.classList.remove(b)}else{controlsDiv.classList.add(a);collapseIcon.classList.add(b)}});const controlsDiv=document.getElementById(`controls`);const collapseIcon=document.getElementById(`collapse-icon`);let controlsVisible=!1;toggleControls()</script><script src=https://cdn.jsdelivr.net/npm/p5@1.11.3/lib/p5.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/matter-js/0.20.0/matter.min.js></script><script>var resetScene=(()=>{let a=0,b=null;jointAngles=[a,a,a];jointVelocities=[a,a,a];integralError=[a,a,a];previousError=[a,a,a];cubes.forEach(a=>Matter.World.remove(world,a.body));balls.forEach(a=>Matter.World.remove(world,a.body));cubes=[];balls=[];grabbedCube=b;grabbedBall=b;createNewBox();createNewBall()});var drawArm=(a=>{let p=0,q=2;let b=createVector(ANCHOR.x,ANCHOR.y);let c=p;ARM_SEGMENTS.forEach((d,e)=>{c+=a[e];if(e==q){d-=LAST_SEGMENT_VISUAL_OFFSET};const f=createVector(b.x+ d*cos(c),b.y+ d*sin(c));stroke(SEGMENT_COLORS[e]);strokeWeight(13);line(b.x,b.y,f.x,f.y);b=f});b=createVector(b.x+ GRIPPER_OFFSET*cos(c),b.y+ GRIPPER_OFFSET*sin(c));stroke(p);strokeWeight(6);const d=30;const e=d/q;const f=-40*PI/180;const g=gripperClosed?PI/4:p;const h=c- g+ PI/q;const i=c+ g- PI/q;const j=createVector(b.x+ e*cos(h),b.y+ e*sin(h));const k=h+ f;const l=createVector(j.x+ e*cos(k),j.y+ e*sin(k));line(b.x,b.y,j.x,j.y);line(j.x,j.y,l.x,l.y);const m=createVector(b.x+ e*cos(i),b.y+ e*sin(i));const n=i- f;const o=createVector(m.x+ e*cos(n),m.y+ e*sin(n));line(b.x,b.y,m.x,m.y);line(m.x,m.y,o.x,o.y)});var setup=(()=>{let h=30,j=0,f=150,c=2,b=50,d=20,e=200,k=1,g=100,i=parseFloat;const a=createCanvas(800,500);a.parent(`canvasDiv`);ANCHOR.x=width/4;ANCHOR.y=height- b;engine=Matter.Engine.create();world=engine.world;engine.gravity.scale=0.001;ground=new Block(world,{x:width/c,y:height- 10,w:width,h:d,color:`#666`},{isStatic:!0});platform=new Block(world,{x:width/c+ e,y:height- f,w:e,h:d,color:`#444`},{isStatic:!0});cube=new Block(world,{x:width/c- g,y:g,w:h,h:h,color:`#2196F3`},{isStatic:!1,restitution:0.7});cubes.push(cube);armBase=new Block(world,{x:ANCHOR.x,y:ANCHOR.y+ b,w:80,h:g,color:`#888`},{isStatic:!0});greenBall=new Ball(world,{x:width/c- f,y:g,r:25,color:`green`},{isStatic:!1,restitution:0.6});balls.push(greenBall);Matter.Runner.run(engine);kpSlider=document.getElementById(`kpSlider`);kiSlider=document.getElementById(`kiSlider`);kdSlider=document.getElementById(`kdSlider`);kpInput=document.getElementById(`kpInput`);kiInput=document.getElementById(`kiInput`);kdInput=document.getElementById(`kdInput`);resetButton=document.getElementById(`resetButton`);createBallButton=document.getElementById(`createBallButton`);createBoxButton=document.getElementById(`createBoxButton`);joint1MinSlider=document.getElementById(`joint1MinSlider`);joint1MaxSlider=document.getElementById(`joint1MaxSlider`);joint2MinSlider=document.getElementById(`joint2MinSlider`);joint2MaxSlider=document.getElementById(`joint2MaxSlider`);joint3MinSlider=document.getElementById(`joint3MinSlider`);joint3MaxSlider=document.getElementById(`joint3MaxSlider`);joint1MinInput=document.getElementById(`joint1MinInput`);joint1MaxInput=document.getElementById(`joint1MaxInput`);joint2MinInput=document.getElementById(`joint2MinInput`);joint2MaxInput=document.getElementById(`joint2MaxInput`);joint3MinInput=document.getElementById(`joint3MinInput`);joint3MaxInput=document.getElementById(`joint3MaxInput`);KP=i(kpInput.value);KI=i(kiInput.value);KD=i(kdInput.value);jointAngleLimits[j][j]=radians(i(joint1MinInput.value));jointAngleLimits[j][k]=radians(i(joint1MaxInput.value));jointAngleLimits[k][j]=radians(i(joint2MinInput.value));jointAngleLimits[k][k]=radians(i(joint2MaxInput.value));jointAngleLimits[c][j]=radians(i(joint3MinInput.value));jointAngleLimits[c][k]=radians(i(joint3MaxInput.value));kpSlider.oninput=()=>{kpInput.value=kpSlider.value;KP=i(kpSlider.value)};kpInput.onchange=()=>{kpSlider.value=kpInput.value;KP=i(kpInput.value)};kiSlider.oninput=()=>{kiInput.value=kiSlider.value;KI=i(kiSlider.value)};kiInput.onchange=()=>{kiSlider.value=kiInput.value;KI=i(kiInput.value)};kdSlider.oninput=()=>{kdInput.value=kdSlider.value;KD=i(kdSlider.value)};kdInput.onchange=()=>{kdSlider.value=kdInput.value;KD=i(kdInput.value)};setupLimitControl(joint1MinSlider,joint1MinInput,j,j);setupLimitControl(joint1MaxSlider,joint1MaxInput,j,k);setupLimitControl(joint2MinSlider,joint2MinInput,k,j);setupLimitControl(joint2MaxSlider,joint2MaxInput,k,k);setupLimitControl(joint3MinSlider,joint3MinInput,c,j);setupLimitControl(joint3MaxSlider,joint3MaxInput,c,k);resetButton.onclick=resetScene;createBallButton.onclick=createNewBall;createBoxButton.onclick=createNewBox;document.addEventListener(`keydown`,(a=>{if(a.key===`r`||a.key===`R`){resetButton.click()}else if(a.key===`b`||a.key===`B`){createBallButton.click()}else if(a.key===`c`||a.key===`C`){createBoxButton.click()}}))});var calculateIK=(a=>{let c=0,d=1,e=Math;let b=jointAngles.slice();for(let f=c;f<IK_ITERATIONS;f++){let f=getGripperPosition(b);for(let g=ARM_SEGMENTS.length- d;g>=c;g--){const h=getJointPosition(b,g);const i=p5.Vector.sub(f,h);const j=p5.Vector.sub(a,h);let k=j.heading()- i.heading();let l=k*DAMPING_FACTOR;b[g]+=l;b[g]=e.max(jointAngleLimits[g][c],e.min(b[g],jointAngleLimits[g][d]));f=getGripperPosition(b)}};return b});var getGripperPosition=(a=>ARM_SEGMENTS.reduce((c,d,e)=>{const f=a.slice(b,e+ 1).reduce((a,b)=>a+ b,b);return createVector(c.x+ d*cos(f),c.y+ d*sin(f))},createVector(ANCHOR.x,ANCHOR.y)));var setupLimitControl=((a,b,c,d)=>{let e=parseFloat;a.oninput=()=>{b.value=a.value;jointAngleLimits[c][d]=radians(e(a.value))};b.onchange=()=>{a.value=b.value;jointAngleLimits[c][d]=radians(e(b.value))}});var getJointPosition=((a,b)=>ARM_SEGMENTS.slice(c,b).reduce((b,d,e)=>{const f=a.slice(c,e+ 1).reduce((a,b)=>a+ b,c);return createVector(b.x+ d*cos(f),b.y+ d*sin(f))},createVector(ANCHOR.x,ANCHOR.y)));var mousePressed=(()=>{let b=1,c=null;gripperClosed=!gripperClosed;if(gripperClosed){justClosedGripper=!0};const a=getGripperPosition(calculateIK(createVector(mouseX,mouseY)));cubes.forEach((c,d)=>{const e=c.body.position;const f=dist(a.x,a.y,e.x,e.y);console.log(`Cube ${d+ b}:`,e);console.log(`Distance to Cube ${d+ b}:`,f.toFixed(b))});balls.forEach((c,d)=>{const e=c.body.position;const f=dist(a.x,a.y,e.x,e.y);console.log(`Ball ${d+ b}:`,e);console.log(`Distance to Ball ${d+ b}:`,f.toFixed(b))});if(!gripperClosed){if(grabbedCube){Matter.Body.setStatic(grabbedCube.body,!1);grabbedCube=c};if(grabbedBall){Matter.Body.setStatic(grabbedBall.body,!1);grabbedBall=c}}});var createNewBall=(()=>{let b=2,c=300;let a=new Ball(world,{x:random(width/b- c,width/b+ c),y:50,r:25,color:`green`},{restitution:0.6});balls.push(a)});var draw=(()=>{let d=Math;background(180);Matter.Engine.update(engine,16);ground.draw();platform.draw();for(let a of cubes){a.draw()};for(let a of balls){a.draw()};armBase.draw();const a=createVector(mouseX,mouseY);targetAngles=calculateIK(a);for(let a=0;a<jointAngles.length;a++){let b=targetAngles[a]- jointAngles[a];let c=KP*b;integralError[a]+=b;let e=KI*integralError[a];let f=KD*(b- previousError[a]);previousError[a]=b;let g=c+ e+ f;let h=g- jointVelocities[a];if(abs(h)>MAX_JOINT_ACCELERATION){h=d.sign(h)*MAX_JOINT_ACCELERATION};jointVelocities[a]+=h;jointAngles[a]+=jointVelocities[a];jointVelocities[a]=d.max(-MAX_JOINT_VELOCITY,d.min(jointVelocities[a],MAX_JOINT_VELOCITY))};drawArm(jointAngles);const b=getGripperPosition(jointAngles);let c=!1;if(justClosedGripper&&!grabbedBall){for(let a of cubes){if(!grabbedCube){const d=a.body.position;let e=dist(b.x,b.y,d.x,d.y);if(e<GRAB_THRESHOLD){grabbedCube=a;Matter.Body.setStatic(a.body,!0);c=!0;break}}}};if(justClosedGripper&&!grabbedCube&&!c){for(let a of balls){if(!grabbedBall){const d=a.body.position;let e=dist(b.x,b.y,d.x,d.y);if(e<GRAB_THRESHOLD){grabbedBall=a;Matter.Body.setStatic(a.body,!0);c=!0;break}}}};if(grabbedCube){Matter.Body.setPosition(grabbedCube.body,b)};if(grabbedBall){Matter.Body.setPosition(grabbedBall.body,b)};justClosedGripper=!1});var createNewBox=(()=>{let b=2,d=30,c=50;let a=new Block(world,{x:random(width/b- 300,width/b- c),y:c,w:d,h:d,color:`#2196F3`},{restitution:0.7});cubes.push(a)});let engine,world;let ground,platform,cube,greenBall;let grabbedCube=null;let grabbedBall=null;let gripperClosed=!1;let justClosedGripper=!1;const ARM_SEGMENTS=[180,130,100];const SEGMENT_COLORS=[`#FF0000`,`#FFA500`,`#FFD700`];const ANCHOR={x:0,y:0};const GRAB_THRESHOLD=30;const LAST_SEGMENT_VISUAL_OFFSET=26;const GRIPPER_OFFSET=5;const MAX_JOINT_ACCELERATION=0.03;const MAX_JOINT_VELOCITY=0.1;const DAMPING_FACTOR=0.5;const IK_ITERATIONS=30;let KP,KI,KD;let jointAngles=[0,0,0];let jointVelocities=[0,0,0];let targetAngles=[0,0,0];let integralError=[0,0,0];let previousError=[0,0,0];let kpSlider,kiSlider,kdSlider;let kpInput,kiInput,kdInput;let resetButton;let createBallButton,createBoxButton;let joint1MinSlider,joint1MaxSlider,joint2MinSlider,joint2MaxSlider,joint3MinSlider,joint3MaxSlider;let joint1MinInput,joint1MaxInput,joint2MinInput,joint2MaxInput,joint3MinInput,joint3MaxInput;let jointAngleLimits=[[-150,-20],[0,155],[0,155]];let armBase;let balls=[];let cubes=[];class Block{constructor(a,b,c){this.body=Matter.Bodies.rectangle(b.x,b.y,b.w,b.h,c);Matter.World.add(a,this.body);this.w=b.w;this.h=b.h;this.color=b.color}draw(){let c=0;const a=this.body.position;const b=this.body.angle;push();translate(a.x,a.y);rotate(b);rectMode(CENTER);fill(this.color);rect(c,c,this.w,this.h);pop()}}class Ball{constructor(a,b,c){this.body=Matter.Bodies.circle(b.x,b.y,b.r,c);Matter.World.add(a,this.body);this.r=b.r;this.color=b.color}draw(){let c=0;const a=this.body.position;const b=this.body.angle;push();translate(a.x,a.y);rotate(b);ellipseMode(RADIUS);fill(this.color);circle(c,c,this.r);pop()}}</script></body></html>